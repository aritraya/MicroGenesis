package {{ base_package }}.controller;

import {{ base_package }}.service.{{ service_name }};
{% for model_name, model_info in api_info.models.items() %}
{% if model_info.type == "dto" %}
import {{ base_package }}.dto.{{ model_name }};
{% endif %}
{% endfor %}
import lombok.RequiredArgsConstructor;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

/**
 * REST controller for {{ tag }} operations
 */
@RestController
@RequestMapping("/api/{{ tag|lower|replace(" ", "-") }}")
@RequiredArgsConstructor
public class {{ controller_name }} {

    private final {{ service_name }} {{ service_name|first|lower }}{{ service_name[1:] }};

{% for endpoint in endpoints %}
    {% if endpoint.method == "get" and endpoint.path.endswith("}") %}
    @GetMapping("{{ endpoint.path|replace("{", "{") }}")
    public ResponseEntity<?> {{ endpoint.operation_id }}(
        {% for param in endpoint.parameters %}
        {% if param.in == "path" %}
        @PathVariable {{ param.schema.type|default("String") }} {{ param.name }}{% if not loop.last %},{% endif %}
        {% elif param.in == "query" %}
        @RequestParam(required={{ param.required|default("false") }}) {{ param.schema.type|default("String") }} {{ param.name }}{% if not loop.last %},{% endif %}
        {% endif %}
        {% endfor %}
    ) {
        return ResponseEntity.ok({{ service_name|first|lower }}{{ service_name[1:] }}.{{ endpoint.operation_id }}(
            {% for param in endpoint.parameters %}
            {% if param.in == "path" or param.in == "query" %}
            {{ param.name }}{% if not loop.last %}, {% endif %}
            {% endif %}
            {% endfor %}
        ));
    }

    {% elif endpoint.method == "get" %}
    @GetMapping("{{ endpoint.path }}")
    public ResponseEntity<?> {{ endpoint.operation_id }}() {
        return ResponseEntity.ok({{ service_name|first|lower }}{{ service_name[1:] }}.{{ endpoint.operation_id }}());
    }

    {% elif endpoint.method == "post" %}
    @PostMapping("{{ endpoint.path }}")
    public ResponseEntity<?> {{ endpoint.operation_id }}(
        @RequestBody {% for content_type, content in endpoint.request_body.content.items() %}{{ content.schema.ref|split("/")|last }}{% endfor %} request
    ) {
        return ResponseEntity.ok({{ service_name|first|lower }}{{ service_name[1:] }}.{{ endpoint.operation_id }}(request));
    }

    {% elif endpoint.method == "put" %}
    @PutMapping("{{ endpoint.path|replace("{", "{") }}")
    public ResponseEntity<?> {{ endpoint.operation_id }}(
        {% for param in endpoint.parameters %}
        {% if param.in == "path" %}
        @PathVariable {{ param.schema.type|default("String") }} {{ param.name }},
        {% endif %}
        {% endfor %}
        @RequestBody {% for content_type, content in endpoint.request_body.content.items() %}{{ content.schema.ref|split("/")|last }}{% endfor %} request
    ) {
        return ResponseEntity.ok({{ service_name|first|lower }}{{ service_name[1:] }}.{{ endpoint.operation_id }}(
            {% for param in endpoint.parameters %}
            {% if param.in == "path" %}
            {{ param.name }},
            {% endif %}
            {% endfor %}
            request
        ));
    }

    {% elif endpoint.method == "delete" %}
    @DeleteMapping("{{ endpoint.path|replace("{", "{") }}")
    public ResponseEntity<Void> {{ endpoint.operation_id }}(
        {% for param in endpoint.parameters %}
        {% if param.in == "path" %}
        @PathVariable {{ param.schema.type|default("String") }} {{ param.name }}{% if not loop.last %},{% endif %}
        {% endif %}
        {% endfor %}
    ) {
        {{ service_name|first|lower }}{{ service_name[1:] }}.{{ endpoint.operation_id }}(
            {% for param in endpoint.parameters %}
            {% if param.in == "path" %}
            {{ param.name }}{% if not loop.last %}, {% endif %}
            {% endif %}
            {% endfor %}
        );
        return ResponseEntity.noContent().build();
    }
    {% endif %}
{% endfor %}
}
